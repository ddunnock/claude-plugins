---
phase: 04-production-readiness
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mcps/knowledge-mcp/pyproject.toml
  - mcps/knowledge-mcp/poetry.lock
  - mcps/knowledge-mcp/src/knowledge_mcp/evaluation/__init__.py
  - mcps/knowledge-mcp/src/knowledge_mcp/monitoring/__init__.py
autonomous: true

must_haves:
  truths:
    - "New dependencies installable via poetry install"
    - "evaluation/ and monitoring/ packages importable"
    - "All existing tests still pass"
  artifacts:
    - path: "mcps/knowledge-mcp/pyproject.toml"
      provides: "Production readiness dependencies"
      contains: "ragas"
    - path: "mcps/knowledge-mcp/src/knowledge_mcp/evaluation/__init__.py"
      provides: "Evaluation package"
    - path: "mcps/knowledge-mcp/src/knowledge_mcp/monitoring/__init__.py"
      provides: "Monitoring package"
  key_links:
    - from: "pyproject.toml"
      to: "poetry.lock"
      via: "poetry lock"
      pattern: "ragas.*diskcache.*python-json-logger"
---

<objective>
Add production readiness dependencies and create package structure for evaluation and monitoring modules.

Purpose: Establish the dependency and module foundation for Phase 4 features (embedding cache, token tracking, golden tests, RAG metrics).
Output: Updated pyproject.toml with new dependencies, evaluation/ and monitoring/ packages ready for implementation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@mcps/knowledge-mcp/pyproject.toml
@.planning/phases/04-production-readiness/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add production readiness dependencies</name>
  <files>mcps/knowledge-mcp/pyproject.toml, mcps/knowledge-mcp/poetry.lock</files>
  <action>
Add the following dependencies to pyproject.toml:

**Main dependencies (under [tool.poetry.dependencies]):**
- `diskcache = ">=5.6.0"` — Persistent embedding cache

**Dev dependencies (under [tool.poetry.group.dev.dependencies]):**
- `ragas = ">=0.2.0"` — RAG evaluation framework with RAG Triad metrics
- `pytest-golden = ">=0.2.0"` — Golden test pattern with YAML support
- `python-json-logger = ">=2.0.0"` — Structured JSON logging

Note: tiktoken already present (>=0.5.0), rich already present (>=13.0.0).

After editing pyproject.toml, run:
```bash
cd mcps/knowledge-mcp && poetry lock && poetry install --with dev
```

Verify installation:
```bash
poetry run python -c "import diskcache; import ragas; print('Dependencies OK')"
```
  </action>
  <verify>`poetry run python -c "import diskcache; import ragas; print('OK')"` succeeds</verify>
  <done>ragas, diskcache, pytest-golden, python-json-logger installed and importable</done>
</task>

<task type="auto">
  <name>Task 2: Create evaluation and monitoring packages</name>
  <files>
mcps/knowledge-mcp/src/knowledge_mcp/evaluation/__init__.py
mcps/knowledge-mcp/src/knowledge_mcp/monitoring/__init__.py
  </files>
  <action>
Create two new packages with proper __init__.py files:

**src/knowledge_mcp/evaluation/__init__.py:**
```python
"""
Evaluation framework for RAG quality assessment.

This package provides:
- Golden test set management
- RAG Triad metrics (context relevance, faithfulness, answer relevance)
- CLI reporting for evaluation results
"""

from __future__ import annotations

__all__: list[str] = []
```

**src/knowledge_mcp/monitoring/__init__.py:**
```python
"""
Production monitoring for knowledge-mcp.

This package provides:
- Token usage tracking for cost visibility
- Structured JSON logging
- Alerting for threshold violations
"""

from __future__ import annotations

__all__: list[str] = []
```

Verify both packages import correctly:
```bash
poetry run python -c "from knowledge_mcp import evaluation, monitoring; print('Packages OK')"
```
  </action>
  <verify>`poetry run python -c "from knowledge_mcp import evaluation, monitoring"` succeeds</verify>
  <done>evaluation/ and monitoring/ packages exist and are importable</done>
</task>

<task type="auto">
  <name>Task 3: Verify existing tests still pass</name>
  <files>None (verification only)</files>
  <action>
Run the existing test suite to ensure dependency additions didn't break anything:

```bash
cd mcps/knowledge-mcp && poetry run pytest tests/ -v --tb=short
```

Expected: All existing tests pass (40+ tests from Phase 1).

If any tests fail, investigate and fix before proceeding. Common issues:
- Dependency conflicts: Check poetry.lock for version incompatibilities
- Import order: Ensure new packages don't interfere with existing imports
  </action>
  <verify>`poetry run pytest tests/ -v` shows all tests passing</verify>
  <done>All existing tests pass, no regressions introduced</done>
</task>

</tasks>

<verification>
Run verification sequence:
```bash
cd mcps/knowledge-mcp

# 1. Check dependencies installed
poetry run python -c "import diskcache, ragas; print('Deps: OK')"

# 2. Check packages importable
poetry run python -c "from knowledge_mcp import evaluation, monitoring; print('Pkgs: OK')"

# 3. Check tests pass
poetry run pytest tests/ -v --tb=short

# 4. Verify pyproject.toml has new entries
grep -E "ragas|diskcache|pytest-golden|python-json-logger" pyproject.toml
```
</verification>

<success_criteria>
- [ ] ragas, diskcache, pytest-golden, python-json-logger in pyproject.toml
- [ ] poetry.lock updated with new dependencies
- [ ] evaluation/ package exists and imports
- [ ] monitoring/ package exists and imports
- [ ] All existing tests pass (no regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/04-production-readiness/04-01-SUMMARY.md`
</output>
